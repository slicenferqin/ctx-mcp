# æ–‡ä»¶ç³»ç»Ÿä½œä¸ºå¤–éƒ¨è®°å¿†ï¼šAI Agentçš„ç»ˆæä¸Šä¸‹æ–‡æ–¹æ¡ˆ

> å½“ä¸Šä¸‹æ–‡çª—å£ä¸å¤Ÿç”¨æ—¶ï¼Œæœ€å¥½çš„è§£å†³æ–¹æ¡ˆä¸æ˜¯å‹ç¼©ï¼Œè€Œæ˜¯å¤–éƒ¨åŒ–ã€‚

## å‰è¨€ï¼šä¸Šä¸‹æ–‡å›°å¢ƒçš„æœ¬è´¨

åœ¨[ä¸Šä¸€ç¯‡æ–‡ç« ](./ai-programming-best-practices.md)ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†AIç¼–ç¨‹çš„ä¸‰å±‚ä¸Šä¸‹æ–‡æ¶æ„å’ŒåŠ¨æ€ä¸Šä¸‹æ–‡ç®¡ç†ã€‚ä½†æœ‰ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜æˆ‘ä»¬åªæ˜¯ç‚¹åˆ°ä¸ºæ­¢ï¼š**å½“ä¸Šä¸‹æ–‡çœŸçš„ä¸å¤Ÿç”¨æ—¶ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ**

ä¼ ç»Ÿçš„è§£å†³æ–¹æ¡ˆæœ‰ä¸‰ç§ï¼š
1. **æˆªæ–­** - ç®€å•ç²—æš´ï¼Œä¿¡æ¯æ°¸ä¹…ä¸¢å¤±
2. **å‹ç¼©** - ç”¨æ‘˜è¦æ›¿ä»£åŸæ–‡ï¼Œä¸å¯é€†
3. **æ»‘åŠ¨çª—å£** - ä¿ç•™æœ€è¿‘çš„Næ¡ï¼Œå†å²ä¿¡æ¯ä¸¢å¤±

è¿™ä¸‰ç§æ–¹æ¡ˆçš„å…±åŒé—®é¢˜æ˜¯ï¼š**å®ƒä»¬éƒ½æ˜¯æœ‰æŸçš„**ã€‚

è€Œæœ€è¿‘ä¸‰ä¸ªé¡¶å°–çš„AI Agentç³»ç»Ÿâ€”â€”Cursorã€Manuså’ŒInfiAgentâ€”â€”ä¸çº¦è€ŒåŒåœ°é€‰æ‹©äº†ç¬¬å››ç§æ–¹æ¡ˆï¼š**æ–‡ä»¶ç³»ç»Ÿä½œä¸ºå¤–éƒ¨è®°å¿†**ã€‚

è¿™ä¸æ˜¯å·§åˆï¼Œè€Œæ˜¯å¯¹Agentæ¶æ„æœ¬è´¨çš„æ·±åˆ»æ´å¯Ÿã€‚

---

## ä¸€ã€æ ¸å¿ƒæ€æƒ³ï¼šä¸ºä»€ä¹ˆæ˜¯æ–‡ä»¶ç³»ç»Ÿï¼Ÿ

### 1.1 æ–‡ä»¶ç³»ç»Ÿçš„ä¸‰å¤§ä¼˜åŠ¿

| ç‰¹æ€§ | ä¼ ç»Ÿä¸Šä¸‹æ–‡ | æ–‡ä»¶ç³»ç»Ÿ |
|-----|-----------|---------|
| **å®¹é‡** | å—é™äºæ¨¡å‹çª—å£(128K-200K tokens) | æ— é™åˆ¶ |
| **æŒä¹…åŒ–** | ä¼šè¯ç»“æŸå³æ¶ˆå¤± | å¤©ç„¶æŒä¹…åŒ– |
| **å¯æ“ä½œæ€§** | åªèƒ½è¯»å– | å¯è¯»ã€å¯å†™ã€å¯æœç´¢ã€å¯ç´¢å¼• |
| **æˆæœ¬** | æ¯æ¬¡ä¼ è¾“éƒ½è®¡è´¹ | åªåœ¨è®¿é—®æ—¶è®¡è´¹ |

### 1.2 ä»"å¯¹è¯å†å²"åˆ°"å·¥ä½œç©ºé—´çŠ¶æ€"

ä¼ ç»ŸAgentçš„æ€ç»´æ¨¡å¼ï¼š
```
ä¸Šä¸‹æ–‡ = ç³»ç»Ÿæç¤º + å¯¹è¯å†å² + å·¥å…·è°ƒç”¨è®°å½•
```

æ–‡ä»¶ç³»ç»ŸèŒƒå¼çš„æ€ç»´æ¨¡å¼ï¼š
```
ä¸Šä¸‹æ–‡ = ç³»ç»Ÿæç¤º + å½“å‰å·¥ä½œç©ºé—´çŠ¶æ€ + æœ€è¿‘Næ­¥æ“ä½œ
```

**å…³é”®åŒºåˆ«**ï¼šå·¥ä½œç©ºé—´çŠ¶æ€æ˜¯**æ‰€æœ‰å†å²æ“ä½œçš„ç´¯ç§¯ç»“æœ**ï¼Œè€Œä¸æ˜¯å†å²æ“ä½œæœ¬èº«ã€‚

ä¸¾ä¸ªä¾‹å­ï¼š

**ä¼ ç»Ÿæ–¹å¼ï¼ˆå¯¹è¯å†å²ï¼‰ï¼š**
```
Step 1: åˆ›å»ºäº†æ–‡ä»¶ data.json
Step 2: å‘ data.json å†™å…¥äº†100è¡Œæ•°æ®
Step 3: ä» data.json è¯»å–äº†å‰10è¡Œ
Step 4: åŸºäºå‰10è¡Œåˆ›å»ºäº† summary.txt
...
Step 100: ä¸Šä¸‹æ–‡çˆ†ç‚¸
```

**æ–‡ä»¶ç³»ç»Ÿæ–¹å¼ï¼ˆå·¥ä½œç©ºé—´çŠ¶æ€ï¼‰ï¼š**
```
å½“å‰çŠ¶æ€ï¼š
- data.json å­˜åœ¨ï¼ŒåŒ…å«100è¡Œæ•°æ®
- summary.txt å­˜åœ¨ï¼ŒåŒ…å«æ•°æ®æ‘˜è¦
- æœ€è¿‘æ“ä½œï¼šè¯»å–äº† summary.txt

å†å²å¦‚ä½•äº§ç”Ÿè¿™ä¸ªçŠ¶æ€ï¼Ÿä¸é‡è¦ï¼ŒçŠ¶æ€æœ¬èº«å°±æ˜¯ç­”æ¡ˆã€‚
```

---

## äºŒã€ä¸‰ç§å®ç°æ–¹æ¡ˆå¯¹æ¯”

### 2.1 Cursorï¼šæ¸è¿›å¼æ–‡ä»¶åŒ–

**æ ¸å¿ƒç­–ç•¥ï¼šå°†ä¸­é—´ç»“æœè½¬åŒ–ä¸ºæ–‡ä»¶**

#### å®ç°ç»†èŠ‚

**1. é•¿å·¥å…·å“åº” â†’ æ–‡ä»¶**
```bash
# ä¼ ç»Ÿæ–¹å¼ï¼šæˆªæ–­è¾“å‡º
$ npm install
...ï¼ˆè¾“å‡º5000è¡Œï¼‰
[æˆªæ–­åˆ°1000è¡Œ]

# Cursoræ–¹å¼ï¼šå†™å…¥æ–‡ä»¶
$ npm install > /tmp/npm-install-output.txt
Agent: æˆ‘å·²å°†è¾“å‡ºä¿å­˜åˆ°æ–‡ä»¶ï¼Œè®©æˆ‘æ£€æŸ¥æœ€åå‡ è¡Œ
$ tail -20 /tmp/npm-install-output.txt
```

**2. å¯¹è¯å†å² â†’ å†å²æ–‡ä»¶**
```
è¾¾åˆ°ä¸Šä¸‹æ–‡ä¸Šé™æ—¶ï¼š
1. ç”Ÿæˆæ‘˜è¦ï¼ˆæœ‰æŸå‹ç¼©ï¼‰
2. å°†å®Œæ•´å†å²å†™å…¥ .chat_history.md
3. Agentå¯ä»¥é€šè¿‡grepæœç´¢å†å²ç»†èŠ‚
```

**3. MCPå·¥å…·æè¿° â†’ å·¥å…·ç›®å½•**
```
ä¼ ç»Ÿæ–¹å¼ï¼š
æ‰€æœ‰100ä¸ªMCPå·¥å…·çš„æè¿°éƒ½åœ¨ç³»ç»Ÿæç¤ºä¸­ï¼ˆ20K tokensï¼‰

Cursoræ–¹å¼ï¼š
.mcp_tools/
â”œâ”€â”€ github/
â”‚   â”œâ”€â”€ create_issue.json
â”‚   â”œâ”€â”€ list_prs.json
â”‚   â””â”€â”€ ...
â””â”€â”€ slack/
    â”œâ”€â”€ send_message.json
    â””â”€â”€ ...

ç³»ç»Ÿæç¤ºåªåŒ…å«ï¼š
- å·¥å…·åç§°åˆ—è¡¨ï¼ˆ1K tokensï¼‰
- å¦‚ä½•æŸ¥æ‰¾å·¥å…·çš„è¯´æ˜

ç»“æœï¼štokenæ¶ˆè€—å‡å°‘ 46.9%
```

#### ä¼˜åŠ¿
- âœ… æ¸è¿›å¼æ”¹é€ ï¼Œä¸éœ€è¦é‡æ„æ•´ä¸ªç³»ç»Ÿ
- âœ… ä¸ç°æœ‰Agentæ¶æ„å…¼å®¹
- âœ… ç«‹å³è§æ•ˆçš„tokenèŠ‚çœ

#### å±€é™
- âš ï¸ ä»ç„¶ä¾èµ–æ‘˜è¦æœºåˆ¶
- âš ï¸ å†å²æ–‡ä»¶å¯èƒ½å¾ˆå¤§ï¼Œæœç´¢æ•ˆç‡é—®é¢˜

---

### 2.2 Manusï¼šæ–‡ä»¶ç³»ç»Ÿä½œä¸ºä¸€ç­‰å…¬æ°‘

**æ ¸å¿ƒç­–ç•¥ï¼šå¯æ¢å¤çš„å‹ç¼©**

#### å®ç°ç»†èŠ‚

**1. å‹ç¼©ç­–ç•¥ï¼šä¿ç•™"æ¢å¤è·¯å¾„"**

```python
# ä¼ ç»Ÿå‹ç¼©ï¼ˆä¸å¯é€†ï¼‰
observation = {
    "type": "web_page",
    "content": "<5000è¡ŒHTML>",
    "summary": "è¿™æ˜¯ä¸€ä¸ªå…³äºReactçš„æ–‡æ¡£é¡µé¢"  # åŸå§‹å†…å®¹ä¸¢å¤±
}

# Manuså‹ç¼©ï¼ˆå¯æ¢å¤ï¼‰
observation = {
    "type": "web_page",
    "url": "https://react.dev/learn",  # ä¿ç•™URL
    "saved_path": "/workspace/cache/react_docs.md",  # ä¿ç•™æœ¬åœ°è·¯å¾„
    "summary": "è¿™æ˜¯ä¸€ä¸ªå…³äºReactçš„æ–‡æ¡£é¡µé¢"
}

# éœ€è¦æ—¶å¯ä»¥æ¢å¤
if need_details:
    content = read_file("/workspace/cache/react_docs.md")
    # æˆ–è€…
    content = fetch_url("https://react.dev/learn")
```

**2. æ–‡ä»¶ç³»ç»Ÿä½œä¸ºç»“æ„åŒ–è®°å¿†**

```bash
/workspace/
â”œâ”€â”€ .agent_memory/
â”‚   â”œâ”€â”€ goals.md              # å½“å‰ç›®æ ‡
â”‚   â”œâ”€â”€ completed_tasks.md    # å·²å®Œæˆä»»åŠ¡
â”‚   â”œâ”€â”€ known_issues.md       # å·²çŸ¥é—®é¢˜
â”‚   â””â”€â”€ context_cache/        # ä¸Šä¸‹æ–‡ç¼“å­˜
â”‚       â”œâ”€â”€ api_docs.md
â”‚       â””â”€â”€ code_analysis.md
â”œâ”€â”€ src/                      # å®é™…å·¥ä½œç›®å½•
â””â”€â”€ output/                   # è¾“å‡ºç»“æœ
```

Agentå­¦ä¼šä¸»åŠ¨ç®¡ç†è¿™äº›æ–‡ä»¶ï¼š
```
Agent: è®©æˆ‘å…ˆæ£€æŸ¥ä¸€ä¸‹ä¹‹å‰çš„ç›®æ ‡
$ cat .agent_memory/goals.md

Agent: æˆ‘éœ€è¦è®°ä½è¿™ä¸ªAPIçš„é™åˆ¶
$ echo "Rate limit: 100 req/min" >> .agent_memory/known_issues.md
```

**3. å¤è¿°æœºåˆ¶ï¼štodo.md**

```markdown
# Current Task: å®ç°ç”¨æˆ·è®¤è¯ç³»ç»Ÿ

## Progress
- [x] è®¾è®¡æ•°æ®åº“schema
- [x] å®ç°JWTç”Ÿæˆé€»è¾‘
- [ ] å®ç°ç™»å½•æ¥å£
- [ ] å®ç°æ³¨å†Œæ¥å£
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•

## Next Steps
1. å®Œæˆç™»å½•æ¥å£çš„å‚æ•°éªŒè¯
2. æ·»åŠ å¯†ç åŠ å¯†
```

æ¯éš”å‡ æ­¥ï¼ŒAgentå°±ä¼šæ›´æ–°è¿™ä¸ªæ–‡ä»¶ï¼Œå°†ç›®æ ‡"å¤è¿°"åˆ°ä¸Šä¸‹æ–‡æœ«å°¾ï¼Œé¿å…"è¿·å¤±åœ¨ä¸­é—´"ã€‚

#### ä¼˜åŠ¿
- âœ… ä¿¡æ¯é›¶ä¸¢å¤±ï¼ˆç†è®ºä¸Šï¼‰
- âœ… Agentå­¦ä¼šä¸»åŠ¨ç®¡ç†è®°å¿†
- âœ… é€‚åˆé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡

#### å±€é™
- âš ï¸ éœ€è¦Agentå…·å¤‡æ–‡ä»¶ç®¡ç†èƒ½åŠ›
- âš ï¸ æ¢å¤æ“ä½œæœ¬èº«ä¹Ÿæ¶ˆè€—token

---

### 2.3 InfiAgentï¼šåæ­¥ç­–ç•¥çš„æ¿€è¿›æ–¹æ¡ˆ

**æ ¸å¿ƒç­–ç•¥ï¼šå®šæœŸ"å¿«ç…§"ï¼Œä¸¢å¼ƒå†å²**

#### å®ç°ç»†èŠ‚

**1. åæ­¥å¾ªç¯**

```python
class InfiAgent:
    def __init__(self):
        self.action_buffer = []  # æœ€å¤šä¿ç•™10ä¸ªåŠ¨ä½œ
        self.workspace_state = None  # å½“å‰å·¥ä½œç©ºé—´çŠ¶æ€

    def step(self, action):
        # æ‰§è¡ŒåŠ¨ä½œ
        result = self.execute(action)
        self.action_buffer.append((action, result))

        # æ¯10æ­¥è§¦å‘thinking
        if len(self.action_buffer) >= 10:
            self.thinking_module()

    def thinking_module(self):
        # 1. æ‰«ææ–‡ä»¶ç³»ç»Ÿï¼Œç”ŸæˆçŠ¶æ€æè¿°
        self.workspace_state = self.scan_workspace()

        # 2. æ¸…ç©ºåŠ¨ä½œç¼“å†²åŒº
        self.action_buffer = []

        # 3. ä¸‹ä¸€è½®åªéœ€è¦ï¼šç³»ç»Ÿæç¤º + workspace_state + æ–°çš„10æ­¥
```

**2. å·¥ä½œç©ºé—´çŠ¶æ€æè¿°**

```markdown
# Workspace State (Updated at Step 50)

## File Structure
/workspace/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ raw_data.csv (1.2MB, 10000 rows)
â”‚   â””â”€â”€ processed_data.json (500KB)
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ preprocess.py (å®Œæˆ)
â”‚   â”œâ”€â”€ model.py (è¿›è¡Œä¸­)
â”‚   â””â”€â”€ utils.py (å®Œæˆ)
â””â”€â”€ results/
    â””â”€â”€ preliminary_results.png

## Key Facts
- æ•°æ®é¢„å¤„ç†å·²å®Œæˆï¼Œæ¸…æ´—äº†500ä¸ªå¼‚å¸¸å€¼
- æ¨¡å‹è®­ç»ƒä»£ç å·²å†™å¥½ï¼Œä½†æœªè¿è¡Œ
- éœ€è¦è°ƒæ•´è¶…å‚æ•°ï¼šlearning_rate

## Recent Context
- åˆšåˆšå®Œæˆäº†æ•°æ®å¯è§†åŒ–
- å‘ç°æ•°æ®åˆ†å¸ƒä¸å‡è¡¡ï¼Œéœ€è¦é‡é‡‡æ ·
```

**3. åµŒå¥—æ³¨æ„åŠ›æœºåˆ¶**

```python
# ä¼ ç»Ÿæ–¹å¼ï¼šç›´æ¥åŠ è½½PDF
context = load_pdf("paper.pdf")  # 50é¡µï¼Œ20K tokens
agent.process(context)

# InfiAgentæ–¹å¼ï¼šå·¥å…·åŒ–è®¿é—®
agent.tools = [
    "answer_from_pdf",  # é—®ç­”å¼è®¿é—®
    "search_in_pdf",    # æœç´¢å¼è®¿é—®
    "summarize_pdf"     # æ‘˜è¦å¼è®¿é—®
]

# Agentä¸»åŠ¨é€‰æ‹©è®¿é—®æ–¹å¼
agent: "æˆ‘éœ€è¦äº†è§£è¿™ç¯‡è®ºæ–‡çš„æ–¹æ³•è®º"
tool_call: answer_from_pdf(
    path="paper.pdf",
    question="What is the methodology?"
)
# åªè¿”å›ç›¸å…³çš„2é¡µå†…å®¹ï¼ˆ2K tokensï¼‰
```

#### ä¼˜åŠ¿
- âœ… çœŸæ­£çš„æ— é™æ—¶é•¿è¿è¡Œ
- âœ… ä¸Šä¸‹æ–‡å¤§å°æ’å®šï¼ˆç³»ç»Ÿæç¤º + çŠ¶æ€ + 10æ­¥ï¼‰
- âœ… ä¸éœ€è¦å‹ç¼©æˆ–æ‘˜è¦

#### å±€é™
- âš ï¸ ä¾èµ–é«˜è´¨é‡çš„çŠ¶æ€æè¿°
- âš ï¸ 10æ­¥å†…çš„å†³ç­–å¯èƒ½ç¼ºä¹é•¿æœŸè®°å¿†
- âš ï¸ thinkingæ¨¡å—æœ¬èº«çš„è´¨é‡è‡³å…³é‡è¦

---

## ä¸‰ã€æ·±åº¦å¯¹æ¯”ï¼šä¸‰ç§æ–¹æ¡ˆçš„é€‚ç”¨åœºæ™¯

### 3.1 å¯¹æ¯”çŸ©é˜µ

| ç»´åº¦ | Cursor | Manus | InfiAgent |
|-----|--------|-------|-----------|
| **å®ç°å¤æ‚åº¦** | ä½ | ä¸­ | é«˜ |
| **æ”¹é€ æˆæœ¬** | ä½ï¼ˆæ¸è¿›å¼ï¼‰ | ä¸­ï¼ˆéœ€è¦è®­ç»ƒAgentï¼‰ | é«˜ï¼ˆéœ€è¦é‡æ„ï¼‰ |
| **ä¿¡æ¯ä¿ç•™** | ä¸­ï¼ˆä¾èµ–æ‘˜è¦ï¼‰ | é«˜ï¼ˆå¯æ¢å¤ï¼‰ | ä¸­ï¼ˆä¾èµ–çŠ¶æ€æè¿°ï¼‰ |
| **tokenæ•ˆç‡** | é«˜ï¼ˆ46.9%èŠ‚çœï¼‰ | é«˜ | æé«˜ï¼ˆæ’å®šï¼‰ |
| **è¿è¡Œæ—¶é•¿** | é•¿ï¼ˆå°æ—¶çº§ï¼‰ | å¾ˆé•¿ï¼ˆå¤©çº§ï¼‰ | æ— é™ |
| **é€‚ç”¨ä»»åŠ¡** | é€šç”¨ç¼–ç¨‹ | å¤æ‚ç ”ç©¶ä»»åŠ¡ | è¶…é•¿æœŸé¡¹ç›® |

### 3.2 é€‰æ‹©æŒ‡å—

**é€‰æ‹©Cursoræ–¹æ¡ˆï¼Œå¦‚æœï¼š**
- âœ… ä½ æœ‰ç°æˆçš„Agentç³»ç»Ÿï¼Œæƒ³å¿«é€Ÿä¼˜åŒ–
- âœ… ä»»åŠ¡æ—¶é•¿åœ¨1-2å°æ—¶å†…
- âœ… ä¸»è¦é—®é¢˜æ˜¯MCPå·¥å…·å¤ªå¤šæˆ–è¾“å‡ºå¤ªé•¿
- âœ… å›¢é˜Ÿå¯¹Agentè¡Œä¸ºæœ‰ä¸¥æ ¼è¦æ±‚ï¼ˆä¸å¸Œæœ›Agentè‡ªä¸»ç®¡ç†æ–‡ä»¶ï¼‰

**é€‰æ‹©Manusæ–¹æ¡ˆï¼Œå¦‚æœï¼š**
- âœ… ä»»åŠ¡éœ€è¦è·¨å¤šä¸ªä¼šè¯ï¼ˆå‡ å¤©ç”šè‡³å‡ å‘¨ï¼‰
- âœ… ä¿¡æ¯ä¸èƒ½ä¸¢å¤±ï¼ˆå¦‚ç§‘ç ”ã€æ³•å¾‹æ–‡æ¡£åˆ†æï¼‰
- âœ… æ„¿æ„æŠ•å…¥æ—¶é—´è®­ç»ƒAgentçš„æ–‡ä»¶ç®¡ç†èƒ½åŠ›
- âœ… éœ€è¦Agentä»é”™è¯¯ä¸­å­¦ä¹ ï¼ˆä¿ç•™é”™è¯¯å†å²ï¼‰

**é€‰æ‹©InfiAgentæ–¹æ¡ˆï¼Œå¦‚æœï¼š**
- âœ… ä»»åŠ¡æ˜¯çœŸæ­£çš„"æ— é™æ—¶é•¿"ï¼ˆå¦‚æŒç»­ç›‘æ§ã€é•¿æœŸç ”ç©¶ï¼‰
- âœ… å¯ä»¥æ¥å—å®šæœŸ"é—å¿˜"ç»†èŠ‚ï¼ˆåªä¿ç•™çŠ¶æ€ï¼‰
- âœ… æœ‰èƒ½åŠ›å®ç°é«˜è´¨é‡çš„thinkingæ¨¡å—
- âœ… ä»»åŠ¡å¯ä»¥åˆ†è§£ä¸ºæ˜ç¡®çš„é˜¶æ®µï¼ˆæ¯10æ­¥ä¸€ä¸ªå°ç›®æ ‡ï¼‰

---

## å››ã€å®æˆ˜ï¼šå¦‚ä½•åœ¨ä½ çš„é¡¹ç›®ä¸­åº”ç”¨

### 4.1 æœ€å°å¯è¡Œå®ç°ï¼ˆMVPï¼‰

å¦‚æœä½ ç°åœ¨å°±æƒ³å°è¯•ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªæœ€ç®€å•çš„å®ç°ï¼š

```python
import os
from pathlib import Path

class FileBasedMemory:
    def __init__(self, workspace: str):
        self.workspace = Path(workspace)
        self.memory_dir = self.workspace / ".agent_memory"
        self.memory_dir.mkdir(exist_ok=True)

    def save_observation(self, key: str, content: str, summary: str):
        """ä¿å­˜è§‚å¯Ÿç»“æœï¼Œåªåœ¨ä¸Šä¸‹æ–‡ä¸­ä¿ç•™æ‘˜è¦"""
        # ä¿å­˜å®Œæ•´å†…å®¹åˆ°æ–‡ä»¶
        file_path = self.memory_dir / f"{key}.txt"
        file_path.write_text(content)

        # è¿”å›æ‘˜è¦å’Œè·¯å¾„ï¼ˆæ”¾å…¥ä¸Šä¸‹æ–‡ï¼‰
        return {
            "summary": summary,
            "full_content_path": str(file_path),
            "size": len(content)
        }

    def retrieve(self, key: str) -> str:
        """éœ€è¦æ—¶æ¢å¤å®Œæ•´å†…å®¹"""
        file_path = self.memory_dir / f"{key}.txt"
        if file_path.exists():
            return file_path.read_text()
        return None

    def get_workspace_state(self) -> str:
        """ç”Ÿæˆå·¥ä½œç©ºé—´çŠ¶æ€æè¿°"""
        state = ["# Workspace State\n"]

        # åˆ—å‡ºæ‰€æœ‰æ–‡ä»¶
        state.append("## Files:")
        for file in self.workspace.rglob("*"):
            if file.is_file() and not file.match(".agent_memory/*"):
                size = file.stat().st_size
                state.append(f"- {file.relative_to(self.workspace)} ({size} bytes)")

        # åˆ—å‡ºè®°å¿†æ–‡ä»¶
        state.append("\n## Cached Observations:")
        for file in self.memory_dir.glob("*.txt"):
            state.append(f"- {file.stem}")

        return "\n".join(state)

# ä½¿ç”¨ç¤ºä¾‹
memory = FileBasedMemory("/path/to/workspace")

# Agentæ‰§è¡Œäº†ä¸€ä¸ªwebæœç´¢
search_result = fetch_url("https://example.com")  # å‡è®¾è¿”å›5000è¡ŒHTML

# ä¸è¦ç›´æ¥æ”¾å…¥ä¸Šä¸‹æ–‡ï¼Œè€Œæ˜¯ä¿å­˜å¹¶è¿”å›æ‘˜è¦
observation = memory.save_observation(
    key="web_search_react_docs",
    content=search_result,
    summary="Reactå®˜æ–¹æ–‡æ¡£ï¼ŒåŒ…å«Hooksã€ç»„ä»¶ã€æ€§èƒ½ä¼˜åŒ–ç­‰ç« èŠ‚"
)

# ä¸Šä¸‹æ–‡ä¸­åªåŒ…å«ï¼š
# {
#   "summary": "Reactå®˜æ–¹æ–‡æ¡£...",
#   "full_content_path": "/workspace/.agent_memory/web_search_react_docs.txt",
#   "size": 50000
# }

# éœ€è¦æ—¶å†æ¢å¤
if agent_needs_details:
    full_content = memory.retrieve("web_search_react_docs")
```

### 4.2 ä¸ä½ çš„Skillsç³»ç»Ÿé›†æˆ

å›é¡¾[ä¸Šä¸€ç¯‡æ–‡ç« ](./ai-programming-best-practices.md)ä¸­çš„Skillsç³»ç»Ÿï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªæ–°çš„Skillï¼š

```markdown
# .ai/skills/memory-management.md

## æ–‡ä»¶ç³»ç»Ÿè®°å¿†ç®¡ç†è§„èŒƒ

### åŸåˆ™
1. **å¤§äº1000 tokensçš„å†…å®¹å¿…é¡»ä¿å­˜åˆ°æ–‡ä»¶**
2. **ä¸Šä¸‹æ–‡ä¸­åªä¿ç•™æ‘˜è¦å’Œæ–‡ä»¶è·¯å¾„**
3. **éœ€è¦æ—¶é€šè¿‡å·¥å…·æ¢å¤å®Œæ•´å†…å®¹**

### è®°å¿†ç›®å½•ç»“æ„
```
.agent_memory/
â”œâ”€â”€ observations/     # å·¥å…·è°ƒç”¨ç»“æœ
â”œâ”€â”€ context_cache/    # ä¸Šä¸‹æ–‡ç¼“å­˜
â”œâ”€â”€ goals.md          # å½“å‰ç›®æ ‡
â””â”€â”€ state.md          # å·¥ä½œç©ºé—´çŠ¶æ€
```

### å·¥å…·ä½¿ç”¨

#### save_to_memory
ä¿å­˜å¤§å‹å†…å®¹åˆ°è®°å¿†ç³»ç»Ÿ
```json
{
  "key": "api_response_user_list",
  "content": "<å®Œæ•´å†…å®¹>",
  "summary": "ç”¨æˆ·åˆ—è¡¨APIè¿”å›äº†500ä¸ªç”¨æˆ·",
  "tags": ["api", "users"]
}
```

#### retrieve_from_memory
æ¢å¤å®Œæ•´å†…å®¹
```json
{
  "key": "api_response_user_list"
}
```

#### update_workspace_state
æ›´æ–°å·¥ä½œç©ºé—´çŠ¶æ€æè¿°ï¼ˆæ¯10æ­¥è°ƒç”¨ä¸€æ¬¡ï¼‰
```json
{
  "force": false
}
```

### æœ€ä½³å®è·µ

âœ… **DO:**
- WebæŠ“å–ç»“æœ â†’ ä¿å­˜ä¸ºMarkdownæ–‡ä»¶
- PDFå†…å®¹ â†’ ä½¿ç”¨ answer_from_pdf è€Œéç›´æ¥åŠ è½½
- å¤§å‹JSON â†’ ä¿å­˜ååªåœ¨ä¸Šä¸‹æ–‡ä¸­ä¿ç•™schema
- æ¯å®Œæˆä¸€ä¸ªå­ä»»åŠ¡ â†’ æ›´æ–° goals.md

âŒ **DON'T:**
- ä¸è¦åœ¨ä¸Šä¸‹æ–‡ä¸­ä¿ç•™å®Œæ•´çš„APIå“åº”
- ä¸è¦é‡å¤è¯»å–åŒä¸€ä¸ªå¤§æ–‡ä»¶
- ä¸è¦åœ¨ä¸Šä¸‹æ–‡ä¸­ä¿ç•™è¶…è¿‡100è¡Œçš„ä»£ç 
```

### 4.3 æ¸è¿›å¼æ”¹é€ è·¯å¾„

**é˜¶æ®µä¸€ï¼šè¯†åˆ«é—®é¢˜ï¼ˆ1å¤©ï¼‰**
```bash
# åˆ†æä½ çš„Agentæ—¥å¿—ï¼Œæ‰¾å‡ºtokenæ¶ˆè€—å¤§æˆ·
grep "tokens" agent.log | sort -n | tail -20

# å¸¸è§é—®é¢˜ï¼š
# - æŸä¸ªå·¥å…·è¿”å›äº†5000è¡Œè¾“å‡º
# - PDFè¢«å®Œæ•´åŠ è½½åˆ°ä¸Šä¸‹æ–‡
# - å¯¹è¯å†å²è¶…è¿‡50è½®
```

**é˜¶æ®µäºŒï¼šä½å‚çš„æœå®ï¼ˆ1å‘¨ï¼‰**
```python
# 1. æˆªæ–­é•¿è¾“å‡º â†’ ä¿å­˜åˆ°æ–‡ä»¶
if len(output) > 1000:
    file_path = save_to_file(output)
    return {"summary": summarize(output), "path": file_path}

# 2. PDFç›´æ¥åŠ è½½ â†’ å·¥å…·åŒ–è®¿é—®
# Before:
context = load_pdf("paper.pdf")

# After:
def answer_from_pdf(pdf_path, question):
    # ä½¿ç”¨RAGæˆ–æœç´¢åªè¿”å›ç›¸å…³éƒ¨åˆ†
    pass
```

**é˜¶æ®µä¸‰ï¼šç³»ç»ŸåŒ–æ”¹é€ ï¼ˆ2-4å‘¨ï¼‰**
```python
# å®ç°å®Œæ•´çš„æ–‡ä»¶ç³»ç»Ÿè®°å¿†
class AgentWithMemory:
    def __init__(self):
        self.memory = FileBasedMemory()
        self.step_count = 0

    def step(self, action):
        result = self.execute(action)

        # å¤§å‹ç»“æœè‡ªåŠ¨ä¿å­˜
        if self.is_large(result):
            result = self.memory.save_observation(...)

        self.step_count += 1

        # æ¯10æ­¥æ›´æ–°çŠ¶æ€
        if self.step_count % 10 == 0:
            self.update_context_with_state()

        return result
```

---

## äº”ã€é™·é˜±ä¸åæ¨¡å¼

### 5.1 å¸¸è§é”™è¯¯

**âŒ é”™è¯¯1ï¼šè¿‡åº¦æ–‡ä»¶åŒ–**
```python
# ä¸è¦è¿™æ ·åš
for i in range(100):
    save_to_file(f"step_{i}.txt", f"Step {i} completed")

# è¿™ä¼šäº§ç”Ÿ100ä¸ªæ— ç”¨æ–‡ä»¶ï¼Œåè€Œå¢åŠ ç®¡ç†æˆæœ¬
```

**âœ… æ­£ç¡®åšæ³•ï¼š**
```python
# åªä¿å­˜æœ‰ä»·å€¼çš„ä¸­é—´ç»“æœ
if is_milestone(step):
    save_to_file(f"milestone_{step}.txt", result)
```

**âŒ é”™è¯¯2ï¼šå¿˜è®°æ¸…ç†**
```python
# æ–‡ä»¶ç³»ç»Ÿä¹Ÿä¼š"çˆ†ç‚¸"
.agent_memory/
â”œâ”€â”€ observation_1.txt
â”œâ”€â”€ observation_2.txt
...
â”œâ”€â”€ observation_9999.txt  # ğŸ’¥
```

**âœ… æ­£ç¡®åšæ³•ï¼š**
```python
# å®šæœŸæ¸…ç†è¿‡æœŸæ–‡ä»¶
def cleanup_old_observations(max_age_hours=24):
    for file in memory_dir.glob("*.txt"):
        if file.stat().st_mtime < time.time() - max_age_hours * 3600:
            file.unlink()
```

**âŒ é”™è¯¯3ï¼šçŠ¶æ€æè¿°è´¨é‡å·®**
```markdown
# å·®çš„çŠ¶æ€æè¿°
## Files
- file1.txt
- file2.txt
- file3.txt

# Agent: "è¿™äº›æ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘è¯¥åšä»€ä¹ˆï¼Ÿ"
```

**âœ… æ­£ç¡®åšæ³•ï¼š**
```markdown
# å¥½çš„çŠ¶æ€æè¿°
## Files
- data/raw_data.csv (10000 rows, å·²æ¸…æ´—)
- src/model.py (è®­ç»ƒä»£ç ï¼Œæœªè¿è¡Œ)
- results/accuracy.png (å½“å‰å‡†ç¡®ç‡: 85%)

## Current Goal
æå‡æ¨¡å‹å‡†ç¡®ç‡åˆ°90%ä»¥ä¸Š

## Next Steps
1. è°ƒæ•´learning_rateå‚æ•°
2. å°è¯•æ•°æ®å¢å¼º
```

### 5.2 æ€§èƒ½é™·é˜±

**é—®é¢˜ï¼šé¢‘ç¹çš„æ–‡ä»¶I/O**
```python
# æ¯æ¬¡éƒ½è¯»æ–‡ä»¶
for i in range(1000):
    state = read_file(".agent_memory/state.md")
    # å¤„ç†...
```

**è§£å†³ï¼šç¼“å­˜ + æƒ°æ€§åŠ è½½**
```python
class SmartMemory:
    def __init__(self):
        self._cache = {}

    def get_state(self):
        if "state" not in self._cache:
            self._cache["state"] = read_file("state.md")
        return self._cache["state"]

    def invalidate_cache(self):
        self._cache.clear()
```

---

## å…­ã€æœªæ¥å±•æœ›ï¼šSSMæ—¶ä»£çš„Agent

### 6.1 ä¸ºä»€ä¹ˆSSMéœ€è¦æ–‡ä»¶ç³»ç»Ÿï¼Ÿ

[çŠ¶æ€ç©ºé—´æ¨¡å‹(SSM)](https://arxiv.org/abs/2312.00752)å¦‚Mambaã€RWKVç­‰ï¼Œç›¸æ¯”Transformeræœ‰ä¸€ä¸ªè‡´å‘½å¼±ç‚¹ï¼š**ç¼ºä¹å®Œæ•´çš„æ³¨æ„åŠ›æœºåˆ¶**ï¼Œéš¾ä»¥å¤„ç†é•¿è·ç¦»ä¾èµ–ã€‚

ä½†å¦‚æœAgentå­¦ä¼šäº†æ–‡ä»¶ç³»ç»Ÿè®°å¿†ï¼š
```
SSM Agent:
- çŸ­æœŸè®°å¿†ï¼šæœ€è¿‘100ä¸ªtokenï¼ˆSSMçš„çº¿æ€§å¤æ‚åº¦ä¼˜åŠ¿ï¼‰
- é•¿æœŸè®°å¿†ï¼šæ–‡ä»¶ç³»ç»Ÿï¼ˆæ— é™å®¹é‡ï¼‰
- æ£€ç´¢æœºåˆ¶ï¼šä¸»åŠ¨æŸ¥è¯¢æ–‡ä»¶ï¼ˆè€Œéè¢«åŠ¨æ³¨æ„åŠ›ï¼‰
```

è¿™å¯èƒ½æ˜¯**ç¥ç»å›¾çµæœº**çš„çœŸæ­£ç»§ä»»è€…ï¼š
- SSM = å¿«é€Ÿçš„"å·¥ä½œè®°å¿†"
- æ–‡ä»¶ç³»ç»Ÿ = æ— é™çš„"é•¿æœŸè®°å¿†"
- å·¥å…·è°ƒç”¨ = "è¯»å†™å¤´"

### 6.2 å¤šæ¨¡æ€çš„æ–‡ä»¶ç³»ç»Ÿ

æœªæ¥çš„Agentä¸ä»…å¤„ç†æ–‡æœ¬ï¼š
```
.agent_memory/
â”œâ”€â”€ text/
â”‚   â””â”€â”€ notes.md
â”œâ”€â”€ images/
â”‚   â””â”€â”€ screenshot_20250121.png
â”œâ”€â”€ audio/
â”‚   â””â”€â”€ meeting_recording.mp3
â”œâ”€â”€ video/
â”‚   â””â”€â”€ demo.mp4
â””â”€â”€ structured/
    â”œâ”€â”€ database.db
    â””â”€â”€ knowledge_graph.json
```

æ¯ç§æ¨¡æ€éƒ½æœ‰å¯¹åº”çš„"å‹ç¼©-æ¢å¤"ç­–ç•¥ï¼š
- å›¾ç‰‡ â†’ ä¿å­˜åŸå›¾ + è§†è§‰æè¿°
- éŸ³é¢‘ â†’ ä¿å­˜åŸæ–‡ä»¶ + è½¬å½•æ–‡æœ¬
- è§†é¢‘ â†’ ä¿å­˜åŸæ–‡ä»¶ + å…³é”®å¸§ + å­—å¹•

---

## ä¸ƒã€æ€»ç»“ï¼šä»"å¯¹è¯"åˆ°"å·¥ä½œç©ºé—´"

### æ ¸å¿ƒæ´å¯Ÿ

1. **ä¸Šä¸‹æ–‡ä¸æ˜¯å¯¹è¯å†å²ï¼Œè€Œæ˜¯å·¥ä½œç©ºé—´çŠ¶æ€**
   - å¯¹è¯å†å²æ˜¯è¿‡ç¨‹ï¼Œå·¥ä½œç©ºé—´æ˜¯ç»“æœ
   - Agentåº”è¯¥å…³æ³¨"ç°åœ¨æ˜¯ä»€ä¹ˆçŠ¶æ€"ï¼Œè€Œé"å¦‚ä½•åˆ°è¾¾è¿™ä¸ªçŠ¶æ€"

2. **æ–‡ä»¶ç³»ç»Ÿæ˜¯æœ€å¥½çš„å¤–éƒ¨è®°å¿†**
   - æ— é™å®¹é‡
   - å¤©ç„¶æŒä¹…åŒ–
   - å¯æ“ä½œã€å¯æœç´¢ã€å¯ç´¢å¼•

3. **å‹ç¼©çš„ç»ˆæå½¢å¼æ˜¯å¤–éƒ¨åŒ–**
   - ä¸è¦è¯•å›¾åœ¨æœ‰é™çš„ä¸Šä¸‹æ–‡ä¸­å¡ä¸‹æ‰€æœ‰ä¿¡æ¯
   - å°†ä¿¡æ¯å¤–éƒ¨åŒ–ï¼ŒæŒ‰éœ€è®¿é—®

### å®æ–½å»ºè®®

| å¦‚æœä½ çš„ä»»åŠ¡æ—¶é•¿æ˜¯... | æ¨èæ–¹æ¡ˆ | å…³é”®æŠ€æœ¯ |
|-------------------|---------|---------|
| < 30åˆ†é’Ÿ | ä¼ ç»Ÿä¸Šä¸‹æ–‡ç®¡ç† | æ»‘åŠ¨çª—å£ + æ‘˜è¦ |
| 30åˆ†é’Ÿ - 2å°æ—¶ | Cursoræ–¹æ¡ˆ | é•¿è¾“å‡ºæ–‡ä»¶åŒ– + MCPå·¥å…·ç´¢å¼• |
| 2å°æ—¶ - 1å¤© | Manusæ–¹æ¡ˆ | å¯æ¢å¤å‹ç¼© + ç»“æ„åŒ–è®°å¿† |
| > 1å¤© | InfiAgentæ–¹æ¡ˆ | åæ­¥ç­–ç•¥ + çŠ¶æ€å¿«ç…§ |

### è¡ŒåŠ¨æ¸…å•

- [ ] åˆ†æä½ çš„Agentæ—¥å¿—ï¼Œæ‰¾å‡ºtokenæ¶ˆè€—å¤§æˆ·
- [ ] å®ç°æœ€ç®€å•çš„æ–‡ä»¶ç³»ç»Ÿè®°å¿†ï¼ˆå‚è€ƒ4.1èŠ‚ï¼‰
- [ ] ä¸ºä½ çš„Skillsç³»ç»Ÿæ·»åŠ è®°å¿†ç®¡ç†è§„èŒƒ
- [ ] é€‰æ‹©ä¸€ä¸ªæ–¹æ¡ˆï¼Œå¼€å§‹æ¸è¿›å¼æ”¹é€ 
- [ ] ç›‘æ§tokenæ¶ˆè€—å’Œä»»åŠ¡æˆåŠŸç‡çš„å˜åŒ–

---

## å…«ã€å»¶ä¼¸é˜…è¯»

### å­¦æœ¯è®ºæ–‡
- [MemGPT: Towards LLMs as Operating Systems](https://arxiv.org/abs/2310.08560) - å°†OSçš„è™šæ‹Ÿå†…å­˜æ¦‚å¿µå¼•å…¥LLM
- [Generative Agents: Interactive Simulacra of Human Behavior](https://arxiv.org/abs/2304.03442) - ä½¿ç”¨è®°å¿†æµ(memory stream)ç®¡ç†é•¿æœŸè®°å¿†
- [InfiAgent: An Infinite-Horizon Framework for General-Purpose Autonomous Agents](https://arxiv.org/abs/2601.03204) - InfiAgentçš„è®ºæ–‡

### å¼€æºé¡¹ç›®
- [Cursor](https://cursor.com/blog/dynamic-context-discovery) - åŠ¨æ€ä¸Šä¸‹æ–‡å‘ç°
- [Manus](https://manus.im) - ç”Ÿäº§çº§Agentå¹³å°
- [InfiAgent](https://github.com/polyuiislab/infiAgent) - æ— é™æ—¶é•¿Agentæ¡†æ¶

### ç›¸å…³æ–‡ç« 
- [ä»"å¯¹è¯å¼ç¼–ç¨‹"åˆ°"ä¸Šä¸‹æ–‡å·¥ç¨‹"](./ai-programming-best-practices.md) - æœ¬ç³»åˆ—çš„ç¬¬ä¸€ç¯‡

---

*æœ¬æ–‡åŸºäºCursorã€Manuså’ŒInfiAgentä¸‰ä¸ªç³»ç»Ÿçš„å…¬å¼€èµ„æ–™å’Œå®è·µç»éªŒæ€»ç»“ã€‚*

**è®¨è®ºä¸åé¦ˆ**ï¼šæ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„å®è·µç»éªŒï¼Œæˆ–è€…æå‡ºé—®é¢˜ã€‚

**ä¸‹ä¸€ç¯‡é¢„å‘Š**ï¼šã€Šå¤šAgentåä½œçš„ä¸Šä¸‹æ–‡åŒæ­¥ï¼šä»å…±äº«è®°å¿†åˆ°åˆ†å¸ƒå¼çŠ¶æ€ã€‹
